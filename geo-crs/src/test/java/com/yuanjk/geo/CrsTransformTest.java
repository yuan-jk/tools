package com.yuanjk.geo;

import org.geotools.geometry.jts.JTS;
import org.geotools.geometry.jts.JTSFactoryFinder;
import org.geotools.geometry.jts.WKTWriter2;
import org.geotools.referencing.CRS;
import org.geotools.referencing.ReferencingFactoryFinder;
import org.geotools.referencing.operation.AbstractCoordinateOperation;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import org.locationtech.jts.geom.Geometry;
import org.locationtech.jts.geom.GeometryFactory;
import org.locationtech.jts.io.ParseException;
import org.locationtech.jts.io.WKTReader;
import org.locationtech.jts.io.WKTWriter;
import org.opengis.referencing.FactoryException;
import org.opengis.referencing.crs.CRSAuthorityFactory;
import org.opengis.referencing.crs.CoordinateReferenceSystem;
import org.opengis.referencing.operation.MathTransform;
import org.opengis.referencing.operation.TransformException;

import java.util.HashMap;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

public class CrsTransformTest {

    private static final int MAXIMUM_CAPACITY = 1 << 30;

    @Before
    public void setUp() throws Exception {
    }

    @After
    public void tearDown() throws Exception {
    }

    @Test
    public void defineCrs() {
    }

    @Test
    public void wktCrs() {
    }

    @Test
    public void crsToWkt() throws FactoryException {

        String epsgCode1 = "EPSG:4326";
        CrsTransform.crsToWkt(epsgCode1);

        String epsgCode2 = "EPSG:4490";
        CrsTransform.crsToWkt(epsgCode2);

        String epsgCode3 = "EPSG:4545";
        CrsTransform.crsToWkt(epsgCode3);
//        String epsgCode1 = "EPSG:4326";

    }

    @Test
    public void authorityTest() throws FactoryException {
        CRSAuthorityFactory factory = ReferencingFactoryFinder.getCRSAuthorityFactory("EPSG", null);

        factory.getAuthority().getIdentifiers().forEach(i -> System.out.println(i));

//        CoordinateReferenceSystem crs = factory.createCoordinateReferenceSystem("4326");
    }


    @Test
    public void crsToWktFormat() {
    }

    @Test
    public void matchCrs() {
    }

    @Test
    public void findMathTransform() throws ParseException, FactoryException, TransformException {

//        String wkt = "POINT (106.711991 29.562189)";
//        String wkt = "POINT (29.562189 106.711991)";
//        String sourceCrs = "epsg:4490";
//        String targetCrs = "epsg:4545";

//        String wkt = "POINT (128.81165413300005 45.83723777600005)";
        String wkt = "POINT (45.83723777600005 128.81165413300005)";
        String sourceCrs = "epsg:4326";
        String targetCrs = "epsg:4552";

        GeometryFactory geometryFactory = JTSFactoryFinder.getGeometryFactory(null);

        WKTReader reader = new WKTReader(geometryFactory);

        Geometry geometry = reader.read(wkt);

        CoordinateReferenceSystem sourceCRS = CRS.decode(sourceCrs.trim().toUpperCase());
        CoordinateReferenceSystem targetCRS = CRS.decode(targetCrs.trim().toUpperCase());

        MathTransform transform = CRS.findMathTransform(sourceCRS, targetCRS, true);
        WKTWriter2 wktWriter2 = new WKTWriter2();
        System.out.println(wktWriter2.write(JTS.transform(geometry, transform)));
    }

    @Test
    public void transformGeometry() {

        Map<String, Integer> map = new HashMap<>();

        System.out.println(1 << 3);
        System.out.println(1 << 6);
        System.out.println(1 >> 1);
        System.out.println(1 >> 3);


        System.out.println("0b001->" + (0b001));
        System.out.println("0b011->" + (0b011));
        System.out.println("0b100->" + (0b100));

        System.out.println("2=>" + (Integer.toBinaryString(2)));
        System.out.println("2 >> 3=>" + (Integer.toBinaryString(2 >> 3)));
        System.out.println("2<< 3=>" + (Integer.toBinaryString(2 << 3)));

    }

    @Test
    public void axisOrder() {


    }

    @Test
    public void tableSizeForTest() {
        System.out.println("3 -> " + tableSizeFor(3));
        System.out.println("5 -> " + tableSizeFor(5));
        System.out.println("32 -> " + tableSizeFor(32));
        System.out.println("300 -> " + tableSizeFor(300));
        System.out.println("4096 -> " + tableSizeFor(4096));
        System.out.println("4097 -> " + tableSizeFor(4097));
        System.out.println("2^29 " + (2 << 16));
        System.out.println("2^29 + 3 " + tableSizeFor((2 << 16) + 3));
        System.out.println("2^29 + 3 " + tableSizeFor((2 << 16) - 3));
        System.out.println("2^29 :" + ((2 << 26)));
        System.out.println("2^29 :" + tableSizeFor((2 << 26) - 3));
        System.out.println("2^29 :" + tableSizeFor((2 << 26) + 3));

    }

    @Test
    public void printTable() {
        System.out.println("5000 >>> 0: " + (Integer.toBinaryString(5000)));
        System.out.println("5000 >>> 1: " + (Integer.toBinaryString(5000 >>> 1)));
        System.out.println("5000 >>> 2: " + (Integer.toBinaryString(5000 >>> 2)));
        System.out.println("5000 >>> 3: " + (Integer.toBinaryString(5000 >>> 3)));
        System.out.println("5000 >>> 4: " + (Integer.toBinaryString(5000 >>> 4)));
        System.out.println("5000 >>> 8: " + (Integer.toBinaryString(5000 >>> 8)));
        System.out.println("5000 >>> 16: " + (Integer.toBinaryString(5000 >>> 16)));
//        System.out.println("5000 >>> 1" + (Integer.toBinaryString(5000 >>> 32)));
    }


    @Test
    public void printTableA() {
//        System.out.println("5000 >>> 0: " + (tableSizeFor(500)));
        System.out.println("5000 >>> 0: " + (tableSizeFor((0b100000000000000000000001))));
//        System.out.println("5000 >>> 1" + (Integer.toBinaryString(5000 >>> 32)));

        System.out.println("max int: " + Integer.MAX_VALUE);
    }

    private static int tableSizeFor(int cap) {
        int n = cap - 1;
        System.out.println(" >>> 0: " + Integer.toBinaryString(n));
        n |= n >>> 1;
        System.out.println(" >>> 1: " + Integer.toBinaryString(n));
        n |= n >>> 2;
        System.out.println(" >>> 2: " + Integer.toBinaryString(n));
        n |= n >>> 4;
        System.out.println(" >>> 4: " + Integer.toBinaryString(n));
        n |= n >>> 8;
        System.out.println(" >>> 8: " + Integer.toBinaryString(n));
        n |= n >>> 16;
        System.out.println(" >>> 16: " + Integer.toBinaryString(n));
        return (n < 0) ? 1 : (n >= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;
    }

    @Test
    public void hashMapTest() {
        Map<String, Integer> map = new HashMap<>();
        for (int i = 0; i < 1000; i++) {
            map.put("key-" + i, i);
        }
    }

    @Test
    public void concurrentHashMapTest() {
        ConcurrentHashMap<String, String> map = new ConcurrentHashMap<>();
    }


    @Test
    public void transformList() throws ParseException, FactoryException, TransformException {
        System.setProperty("org.geotools.referencing.forceXY", "true");

//        String wktString = "MultiLineString ((12947628.88265525735914707 4849202.3680463619530201, 12947610.947797866538167 4849515.29096064995974302, 12947608.56669395975768566 4849556.83000190928578377, 12947608.41068199463188648 4849575.99307956825941801, 12947608.39477171376347542 4849577.89990182779729366, 12947608.39555600471794605 4849575.99173157755285501, 12947607.80714276060461998 4849818.13002052810043097, 12947607.52602318301796913 4849906.86429292242974043, 12947607.52546929754316807 4849908.21154148038476706, 12947607.68139940500259399 4849924.79112866520881653, 12947607.5979610700160265 4849929.81415406242012978, 12947607.62713075056672096 4849957.82772599626332521, 12947607.33631332218647003 4849972.4455270990729332, 12947607.28580432198941708 4849996.33462538383901119, 12947607.11374055035412312 4850017.40608319919556379, 12947607.10438813082873821 4850040.15146277192980051, 12947607.09701681882143021 4850058.07861051056534052, 12947607.08821823447942734 4850079.47680922504514456, 12947607.08329837024211884 4850091.44191739987581968, 12947607.24041984602808952 4850106.71477680653333664, 12947607.23407270386815071 4850122.15147359389811754, 12947607.27138513140380383 4850130.35978379659354687, 12947607.46446285396814346 4850155.55629647336900234, 12947607.24960765242576599 4850183.32414653152227402, 12947607.16438692063093185 4850192.67612435761839151, 12947607.15714975818991661 4850210.27684485819190741, 12947607.15122241340577602 4850224.69205719325691462, 12947606.98234478570520878 4850238.00470391288399696, 12947606.97682004608213902 4850251.44012897089123726, 12947606.60438451357185841 4850265.03778775781393051, 12947606.59885950200259686 4850278.47259493451565504, 12947606.42964034713804722 4850292.92875223141163588, 12947606.2533003855496645 4850325.96568275429308414, 12947605.75824194960296154 4850340.91080508381128311, 12947605.86622751504182816 4850376.72535725589841604, 12947605.66581476479768753 4850466.69035587459802628, 12947605.59917140193283558 4850529.78484664019197226, 12947605.59801216796040535 4850532.60287184081971645, 12947605.58531187102198601 4850563.47639863379299641, 12947605.40612371638417244 4850602.14976735506206751, 12947605.56169153563678265 4850620.89511546120047569, 12947605.54878913052380085 4850652.25923340115696192, 12947605.33218546956777573 4850682.96947145275771618, 12947605.31981983408331871 4850713.02680657617747784, 12947605.45732733048498631 4850774.40839370340108871, 12947604.9128847885876894 4850810.42642303463071585, 12947604.74130181409418583 4850831.86704911850392818, 12947604.73377924039959908 4850850.14922176208347082, 12947604.72826184891164303 4850863.55813815165311098, 12947604.70517240650951862 4850919.67193377483636141, 12947604.84756826423108578 4850969.17016202490776777, 12947604.7165388185530901 4850990.93755990546196699, 12947604.50325310602784157 4851014.82794098183512688, 12947604.33521702326834202 4851124.93320149183273315, 12947604.18266543000936508 4851298.17988681048154831, 12947604.11542418971657753 4851362.6877267574891448, 12947604.10569974407553673 4851386.31553363241255283, 12947604.10302717797458172 4851392.80914190504699945, 12947603.90632088668644428 4851473.67554562725126743, 12947603.6950199268758297 4851500.00150779727846384, 12947603.56249038130044937 4851516.51767407543957233, 12947603.1984090656042099 4851608.86099960375577211, 12947602.85621821507811546 4851647.70164592191576958, 12947603.01697117276489735 4851654.19586668349802494, 12947603.04495295882225037 4851685.07289631385356188, 12947602.86542991362512112 4851725.75162036996334791, 12947602.52288039959967136 4851765.4502195892855525, 12947602.52013915963470936 4851772.10770286899060011, 12947602.35405354201793671 4851778.56033284496515989, 12947602.48677322268486023 4851853.14067197870463133, 12947602.31500149890780449 4851873.39856873825192451, 12947601.97770485654473305 4851900.64063880499452353, 12947601.97422323748469353 4851909.09493722952902317, 12947601.9706235658377409 4851917.83586708176881075, 12947601.96640178933739662 4851928.0874327989295125, 12947601.96295371279120445 4851936.46019724011421204, 12947601.99947305023670197 4851948.18292379193007946, 12947601.9942926000803709 4851960.76242166478186846, 12947601.8230186328291893 4851981.38819457683712244, 12947601.85771250911056995 4851994.37628231197595596, 12947601.85162315145134926 4852009.16219811979681253, 12947601.89011091180145741 4852016.10553497076034546, 12947601.88033774122595787 4852039.83641052152961493, 12947601.87747831642627716 4852046.77952469792217016, 12947601.90549429878592491 4852075.983321662992239, 12947601.89518284238874912 4852101.02109548728913069, 12947601.89030478335916996 4852112.86571285966783762, 12947601.88202855922281742 4852132.9614552715793252, 12947601.71202987059950829 4852150.48286495078355074, 12947601.70375320501625538 4852170.57868158258497715, 12947601.53167120553553104 4852191.57241468597203493, 12947601.51407404057681561 4852234.296242187730968, 12947601.32487617805600166 4852298.42252409737557173, 12947601.0681639201939106 4852328.85149460006505251, 12947601.10478859767317772 4852338.7359114671126008, 12947600.98170655220746994 4852341.14591092616319656, 12947600.7919981274753809 4852405.23143018502742052, 12947600.61822274141013622 4852431.9037892073392868, 12947599.93582431972026825 4852504.89323123823851347, 12947599.85082836821675301 4852513.63392717111855745, 12947599.5320014450699091 4852594.42667416576296091, 12947599.37947794422507286 4852666.68414050340652466, 12947599.32777049019932747 4852693.39816833473742008, 12947599.34730777144432068 4852744.742330277338624, 12947598.78745588846504688 4852818.14334546588361263, 12947598.63404274731874466 4852894.11894125491380692, 12947598.60905474424362183 4852954.73717222362756729, 12947598.60055129788815975 4852975.36540257185697556, 12947598.59022920951247215 4853000.40525704808533192, 12947598.41654245741665363 4853025.24029042944312096, 12947598.24328791908919811 4853050.60687022469937801, 12947598.23296495340764523 4853075.64638701267540455, 12947598.0592547319829464 4853100.84930532611906528, 12947598.04879617318511009 4853126.21638732776045799, 12947598.03840499557554722 4853151.41987679246813059, 12947598.19081239029765129 4853177.89051110111176968, 12947597.97532234899699688 4853205.70789564121514559, 12947597.71751400455832481 4853238.71247372403740883, 12947597.62687133438885212 4853259.54549715016037226, 12947596.0040963813662529 4853439.76867443230003119, 12947595.78446505777537823 4853477.59584807138890028, 12947595.22879970818758011 4853538.78761875163763762, 12947595.05748302675783634 4853559.41593574173748493, 12947595.04888655059039593 4853580.24984028283506632, 12947594.87704665027558804 4853600.8788935961201787, 12947594.79222177900373936 4853609.17124170530587435, 12947594.70566029287874699 4853621.6716536171734333, 12947594.69706315733492374 4853642.50516287889331579, 12947594.48430510424077511 4853663.33802684955298901, 12947594.31298432871699333 4853683.96725024189800024, 12947594.30438602156937122 4853704.80141009204089642, 12947594.2958046942949295 4853725.59430421888828278, 12947594.29029158502817154 4853738.95275555737316608, 12947593.92601375468075275 4853831.357027149759233, 12947593.72475781664252281 4853924.49856931995600462, 12947593.57608990557491779 4853988.83955063112080097, 12947593.52992844209074974 4854000.48218913562595844, 12947593.50631904788315296 4854057.6750362841412425, 12947593.31785408593714237 4854119.81123826280236244, 12947592.83678609691560268 4854199.26861879229545593, 12947592.44392144680023193 4854261.93602373544126749, 12947594.85470533557236195 4854598.67874026671051979, 12947594.23001534678041935 4854908.15282918326556683))";
        String wktString = "MultiLineString ((12936585.01202508248388767 4850037.43407151754945517, 12936572.13751194439828396 4849881.19392158836126328, 12936511.82735782116651535 4849621.58981780987232924, 12936472.96487080492079258 4849525.03976750373840332, 12936405.01603264920413494 4849333.75345253013074398, 12936332.25394037924706936 4849105.68428504373878241, 12936252.24245745502412319 4848840.83540860842913389, 12936208.76218942552804947 4848593.14918632991611958, 12936196.93102020956575871 4848365.07790606003254652, 12936209.64273289777338505 4848024.19618768803775311, 12936248.98504595085978508 4847793.66809864994138479, 12936298.01611574739217758 4847599.92548791691660881, 12936422.7871278990060091 4847271.29514377471059561, 12936564.54095764644443989 4846989.2628925247117877, 12936789.2900371365249157 4846606.68945693504065275, 12937175.27180148102343082 4845947.05307190865278244, 12937422.00939242355525494 4845522.86484970804303885, 12937522.21095151826739311 4845321.816396564245224, 12937576.09799956157803535 4845128.13241313863545656, 12937637.62590459734201431 4844699.10306388046592474, 12937694.68724922090768814 4844250.79794915579259396, 12937733.48241070285439491 4844115.65310516208410263, 12937765.26424778066575527 4844042.11129005905240774, 12937884.98483689315617085 4843816.58720523770898581, 12938236.57832004502415657 4843331.25717917736619711, 12938500.27387456782162189 4842973.42391778249293566, 12938737.07386098243296146 4842686.6955825574696064, 12938903.08547143824398518 4842483.3044945802539587, 12939027.64372445270419121 4842294.61760089825838804, 12939218.15376420691609383 4842000.5743563761934638, 12939279.20479747466742992 4841914.81741809193044901, 12939406.11830062791705132 4841797.22969127353280783, 12939518.35102575086057186 4841726.20729935728013515, 12939657.40111618116497993 4841660.10430997051298618, 12939867.18540860898792744 4841579.3438287042081356, 12940162.35287061519920826 4841483.95053872186690569, 12940340.46286545693874359 4841410.55429039243608713, 12940494.22454893030226231 4841310.19178280513733625, 12940638.26480276510119438 4841185.32355999667197466, 12940792.14793965592980385 4840986.9524706220254302, 12941143.97979494370520115 4840455.51112836040556431, 12941635.1096368245780468 4839713.56832379475235939, 12942045.62229518033564091 4839106.41313110943883657, 12942351.14987956546247005 4838580.05158411711454391, 12942502.82023735530674458 4838183.36645532306283712, 12942598.38778922148048878 4837754.76992651075124741, 12942620.61420545540750027 4837465.7211939413100481, 12942638.11636900529265404 4837002.74270349461585283, 12942665.2224076371639967 4836711.27222491335123777, 12942731.40562738850712776 4836380.67821407783776522, 12942817.0950970184057951 4836064.82301480881869793, 12943020.28175101615488529 4835327.88040796760469675, 12943189.18892092257738113 4834713.40241307392716408, 12943338.47502631321549416 4834206.6927973311394453, 12943392.27614214085042477 4834069.64077542070299387, 12943509.61213639006018639 4833829.84859269019216299, 12943668.42858443781733513 4833599.93821617588400841, 12943807.6602040845900774 4833450.81606385391205549, 12943934.65736202709376812 4833345.75812747050076723, 12944021.61259349621832371 4833291.66314254514873028, 12944051.01919986121356487 4833273.36994573660194874, 12944230.12313873134553432 4833184.71920610964298248, 12944481.6081449631601572 4833114.22078306786715984, 12944679.36388793028891087 4833099.94742047972977161, 12944852.70655850879848003 4833102.77261656709015369, 12945030.92475645057857037 4833135.00248401053249836, 12945231.11516988649964333 4833194.22820260562002659, 12945441.07178802788257599 4833285.32143732346594334, 12945663.23345871828496456 4833418.08624095283448696, 12945882.9638264998793602 4833570.44886292703449726, 12946051.57061287388205528 4833689.78045465052127838, 12946306.51297265291213989 4833874.00550800375640392, 12946508.09060258604586124 4834015.27837895229458809, 12946686.38549173437058926 4834133.29228700138628483, 12946848.55130261741578579 4834206.47366045322269201, 12947025.28981920517981052 4834259.83823260106146336, 12947187.22597342915832996 4834286.45443239249289036, 12947336.17460139468312263 4834294.18652597814798355, 12947349.8499095756560564 4834294.46827915497124195, 12947519.57706576026976109 4834284.90170449856668711, 12947658.88667200691998005 4834265.68828889913856983, 12947790.86626608669757843 4834248.9059641482308507, 12948397.03966210037469864 4834157.51917783636599779, 12949345.49882460385560989 4834005.88302118144929409, 12949709.74295366741716862 4833953.02169167902320623, 12950010.42866641283035278 4833922.01782376039773226, 12950477.34598553366959095 4833891.46056595258414745, 12951670.27095687016844749 4833811.32904870714992285, 12952755.49833118915557861 4833730.65271876100450754, 12953129.41229449957609177 4833706.97761845123022795, 12953654.79092737846076488 4833666.41156360227614641, 12953864.91918639652431011 4833637.42283802013844252, 12954040.82625249959528446 4833596.11113359034061432, 12954236.25252371840178967 4833493.59846006985753775, 12954358.37885908596217632 4833403.19557283446192741, 12954434.08708829991519451 4833322.50745654664933681, 12954561.0603644959628582 4833134.15072477422654629, 12954590.35098226182162762 4833058.28328353725373745, 12954648.92257815040647984 4832882.06256570480763912, 12954678.8385175745934248 4832724.29614875465631485, 12954736.70118305087089539 4832375.31630745995789766, 12954885.40887229703366756 4831511.20184317883104086, 12954958.59721670486032963 4831288.50037553440779448, 12955056.21885396912693977 4831124.59456801600754261, 12955109.91789823025465012 4831063.45748878642916679, 12955190.06953229196369648 4830994.59284941293299198, 12955282.08976966142654419 4830936.91040245164185762, 12955380.87741399183869362 4830889.96896863449364901, 12955488.2895549051463604 4830860.71503814309835434, 12955563.96803903020918369 4830851.00657109171152115, 12955705.02926347218453884 4830849.76161501184105873, 12955863.98430673405528069 4830874.15742561686784029, 12955988.74457475356757641 4830905.2927927216514945, 12956420.81011632271111012 4831032.93977321870625019, 12956725.90419502556324005 4831131.04924303200095892, 12957343.30175556801259518 4831319.77079451456665993, 12957941.03045387007296085 4831500.9346139095723629, 12958438.61894002743065357 4831655.00892592407763004, 12958865.39055926539003849 4831791.85025523602962494, 12959107.65083730965852737 4831881.59085070807486773, 12959345.57506666891276836 4831996.61692298203706741, 12959449.60654712654650211 4832063.57041407562792301, 12959541.88316220231354237 4832127.80598841421306133, 12959635.62026499025523663 4832201.68481231946498156, 12959724.65081347711384296 4832287.9955094875767827, 12959894.47809872590005398 4832473.87820267491042614, 12960009.14857112616300583 4832647.56815785355865955, 12960155.60342199914157391 4832953.43477664608508348, 12960199.55081441253423691 4833058.66190692596137524, 12960331.47532201930880547 4833469.84963904786854982, 12960429.22319466434419155 4833802.73551745526492596, 12960597.74452441744506359 4834267.74465915095061064, 12960714.89597269892692566 4834500.18683555256575346, 12960851.53098598495125771 4834727.68911190144717693, 12961041.75698855333030224 4834957.51905747596174479, 12961231.93160456605255604 4835143.24561150744557381, 12961338.81876586191356182 4835221.24397433269768953, 12961519.52450135909020901 4835336.06665921490639448, 12961697.39836125634610653 4835426.24978950247168541, 12961921.52463987469673157 4835513.84254234842956066, 12962060.35614760965108871 4835550.20612115133553743, 12962269.78634356334805489 4835586.35557354334741831, 12962396.40099487267434597 4835600.68202302604913712, 12962525.43519230559468269 4835607.6439932445064187, 12962732.36139756999909878 4835619.25059544108808041, 12962934.38461848720908165 4835616.15231571905314922, 12963518.4158293679356575 4835582.30565469991415739, 12963773.90492471307516098 4835586.26900031231343746, 12963951.52893259190022945 4835600.294315698556602, 12964158.38166889548301697 4835653.37917946837842464, 12964326.3152962364256382 4835718.84603174589574337, 12964484.54789790324866772 4835813.731958226300776, 12964676.90236439742147923 4835967.25086136348545551, 12964832.79568947106599808 4836142.95580501109361649, 12965020.39802299439907074 4836389.55225004814565182, 12965322.52621748857200146 4836802.20417631976306438, 12965585.66993164643645287 4837163.56639259681105614, 12965907.27758246660232544 4837598.13303367234766483, 12966121.70423814840614796 4837903.34693704545497894, 12966409.18143435567617416 4838276.79418914578855038, 12966530.9328286200761795 4838393.7947846120223403, 12966633.18828941136598587 4838481.48819938860833645, 12966837.62691628374159336 4838610.3150244103744626, 12966998.22662165947258472 4838692.80207251198589802, 12968015.25875718519091606 4839177.49475425854325294, 12968608.93215921707451344 4839465.84542202018201351, 12969270.33209488913416862 4839777.94491272326558828, 12969600.14277690090239048 4839934.60804957244545221, 12969942.77098741941154003 4840097.5274031488224864, 12970055.49813533015549183 4840162.59808238875120878, 12970087.46920054033398628 4840181.05277852807193995, 12970274.12752455472946167 4840325.68165408447384834, 12970523.74131579138338566 4840565.80336306616663933, 12970912.49877752363681793 4840943.16906976420432329, 12971369.92311927117407322 4841385.34766619745641947, 12971899.87833299487829208 4841900.00852224603295326, 12972428.02932109497487545 4842405.15133693441748619, 12972820.90916627831757069 4842790.30143399629741907, 12973202.4148061852902174 4843162.13388371560722589, 12973568.72278727032244205 4843514.91587106510996819, 12973713.74270328693091869 4843656.04877789504826069, 12973862.60871965065598488 4843808.67480483185499907, 12973971.46091924048960209 4843946.17421988490968943, 12974070.82450082525610924 4844095.23378952033817768, 12974124.38173229992389679 4844198.50993077829480171, 12974202.95557353645563126 4844414.80218852125108242, 12974233.90896105393767357 4844627.50768981873989105, 12974238.10653976537287235 4844800.08196849375963211, 12974213.94869058206677437 4845068.69248119182884693, 12974157.65329031087458134 4845446.79365577641874552, 12974090.10196872428059578 4845903.60267919022589922, 12974066.00738921947777271 4846202.93156813271343708, 12974062.65615758299827576 4846408.17709409724920988, 12974074.42837704718112946 4846561.56102416571229696, 12974119.45723186805844307 4847104.15835978556424379, 12974149.2509919349104166 4847646.86240698304027319, 12974146.7738514319062233 4848241.55762695893645287, 12974144.15838269330561161 4848774.89631209149956703, 12974103.56216179579496384 4849366.01589794736355543, 12974045.85436076298356056 4849976.44511780701577663, 12973976.64228161610662937 4850558.18919711094349623, 12973892.24749988317489624 4851170.74919783137738705, 12973736.30619730800390244 4852182.89270509593188763, 12973698.67630061879754066 4852403.79217665083706379, 12973634.93214192986488342 4852883.93127036560326815, 12973597.79793030582368374 4853333.24324099812656641, 12973562.86529297009110451 4853918.84405968524515629, 12973537.52647277340292931 4854535.14144172612577677, 12973510.22861005365848541 4855128.45004572905600071, 12973477.46311371959745884 4855838.93125850427895784, 12973452.20310055278241634 4856495.66403479967266321, 12973424.55404151603579521 4856931.64762379974126816, 12973409.71863816864788532 4857123.73053673561662436, 12973370.83195364288985729 4857307.25149618647992611, 12973353.10218728519976139 4857390.92461311910301447, 12973298.22085337340831757 4857579.3906834963709116, 12973201.43189004436135292 4857785.36796495784074068, 12973089.38697666674852371 4857989.51306737493723631, 12972918.31570163555443287 4858228.55004594102501869, 12972775.73579398170113564 4858417.51553880982100964, 12972500.09652837365865707 4858789.65293910354375839, 12972367.06443987041711807 4858986.26777544338256121, 12972211.35494919680058956 4859279.03799056354910135, 12972133.58120384998619556 4859465.75779450219124556, 12971978.16645396500825882 4859906.42938666325062513, 12971798.23233663849532604 4860481.70916510000824928, 12971623.87780657038092613 4860993.60774137172847986, 12971500.61714855954051018 4861320.84266226831823587, 12971289.92166640795767307 4861781.12784027587622404, 12971050.59359215758740902 4862228.15251280646771193, 12970786.45651018247008324 4862667.65518989134579897, 12970396.88353799656033516 4863319.2251580972224474, 12970090.88213637098670006 4863820.49721327144652605, 12969969.24518249928951263 4864024.85080686863511801, 12969718.3429292906075716 4864439.37495140358805656, 12969493.97452637366950512 4864774.9794158237054944, 12969225.78056620433926582 4865133.89572804886847734, 12969012.72826569341123104 4865415.64301630854606628, 12968726.3874348271638155 4865794.23013878148049116, 12968280.23576798103749752 4866394.58244270086288452, 12968189.2285512275993824 4866519.55686529539525509, 12967874.75912023894488811 4866940.83786182664334774, 12967610.09804574400186539 4867296.9338689623400569, 12967423.31444664672017097 4867553.13419162947684526, 12967250.16799887083470821 4867737.1316736126318574, 12967077.44143868051469326 4867863.74348134454339743, 12966906.38716900534927845 4867969.1598157212138176, 12966655.99325891025364399 4868073.07206553220748901, 12966438.54139283858239651 4868121.31619394198060036, 12966270.32886718213558197 4868139.087927570566535, 12965829.989712780341506 4868140.89803065825253725, 12964483.02148115448653698 4868149.62015033792704344, 12964339.75508476234972477 4868155.75159669946879148, 12964243.3338707722723484 4868170.00978008564561605, 12964122.12304704636335373 4868195.45782590284943581, 12963907.26045297272503376 4868262.87135624978691339, 12963502.30692915432155132 4868422.50860839709639549, 12962940.19326323829591274 4868643.61870456859469414, 12962181.77757347747683525 4868941.95490893255919218, 12961743.73114918172359467 4869085.4939401363953948, 12961536.85242694057524204 4869124.85725241340696812, 12961020.87057104334235191 4869153.7827761210501194, 12960112.70701335743069649 4869166.55408104788511992, 12959101.91675437986850739 4869187.22689279448240995, 12957850.13774274103343487 4869212.86501526087522507, 12956354.20027046278119087 4869240.1875658156350255, 12955568.51004573330283165 4869247.79765665531158447, 12954073.96670392155647278 4869267.81614481005817652, 12952938.78092262335121632 4869287.74886656645685434, 12951717.47202925570309162 4869307.05853222776204348, 12950626.18513218499720097 4869320.84510901942849159, 12950454.45740621536970139 4869300.95560772344470024, 12950291.04291626065969467 4869264.43858776148408651, 12949858.9859711080789566 4869085.67022070474922657, 12949396.4932678434997797 4868884.61185059510171413, 12948942.32844904065132141 4868744.61207432392984629, 12948637.71946476586163044 4868671.6208206545561552, 12948092.2287351880222559 4868570.21812259964644909, 12947350.25564808584749699 4868412.81578570045530796, 12946984.87854452803730965 4868298.08835752122104168, 12946536.52952132187783718 4868141.55271172057837248, 12946423.0646457951515913 4868110.74417839664965868, 12946149.10171040706336498 4868049.01518824882805347, 12944724.31684150546789169 4867843.15194083005189896, 12943985.96903603710234165 4867730.66071097832173109, 12943701.23669428005814552 4867644.11720898281782866, 12943538.19497375003993511 4867546.72267583478242159, 12943366.96669931523501873 4867338.3599044531583786, 12943273.13472392410039902 4867155.11040041130036116, 12943179.33549743704497814 4866941.35348653048276901, 12943079.98339557833969593 4866766.42955499514937401, 12942988.86404871568083763 4866666.41883675940334797, 12942908.7754850946366787 4866599.71588687784969807, 12942872.86546160653233528 4866580.24114173091948032, 12942732.00506022945046425 4866494.03037081193178892, 12942627.0388799887150526 4866449.48764815181493759, 12942505.48519464023411274 4866421.56756890937685966, 12942350.77567180618643761 4866401.92581532150506973, 12941621.5355534628033638 4866359.36837467458099127, 12941066.48031804710626602 4866331.0287675354629755, 12940906.35152244940400124 4866314.2319702384993434, 12940652.42300474084913731 4866247.43561387620866299, 12940445.48187823779881001 4866155.73452061228454113, 12939979.33244273252785206 4865886.36065074801445007, 12939777.99581365659832954 4865786.39059845078736544, 12939518.73694765195250511 4865686.4069770984351635, 12939149.14584096148610115 4865597.49751313589513302, 12938578.32935653999447823 4865464.20902974810451269, 12938349.5388578400015831 4865375.41904348600655794, 12938167.66274997778236866 4865278.32730557397007942, 12938013.41408403590321541 4865153.51290077436715364, 12937925.30982230231165886 4865059.21356332488358021, 12937818.00963185168802738 4864892.80919364560395479, 12937765.76837829127907753 4864790.19629058428108692, 12937694.47177474945783615 4864515.64163989573717117, 12937670.26770530827343464 4864083.02307703625410795, 12937676.52548391185700893 4863553.36703832820057869, 12937646.99580131471157074 4862990.46697097178548574, 12937625.22970036789774895 4862788.05303123313933611, 12937570.703891322016716 4862363.82977255713194609, 12937472.51406926475465298 4861640.19871228281408548, 12937213.33088559843599796 4859838.29046504944562912, 12937074.26634460501372814 4858851.5422806553542614, 12937027.75761686824262142 4858632.58985433075577021, 12936915.23749124258756638 4858349.90962681453675032, 12936742.24093428812921047 4857995.19602775666862726, 12936698.3901124931871891 4857851.09200141858309507, 12936662.86589732579886913 4857665.41801715921610594, 12936644.13008759170770645 4857305.15142128523439169, 12936656.55166118405759335 4856371.27433867007493973, 12936682.66681540012359619 4855484.58336901478469372, 12936679.36134645342826843 4855002.67600273620337248, 12936664.70478528738021851 4854611.8327774116769433, 12936607.85763075761497021 4853969.10545838251709938, 12936567.17080978862941265 4853567.42303180322051048, 12936554.74896153435111046 4852496.32400995958596468, 12936556.98651145212352276 4851535.80266449507325888, 12936560.43314538709819317 4850929.93073676433414221, 12936576.28051950968801975 4850487.00156459491699934, 12936591.99584134481847286 4850130.63507041428238153, 12936585.01202508248388767 4850037.43407151754945517))";
        WKTReader wktReader = new WKTReader();
        Geometry haidian = wktReader.read(wktString);

        CoordinateReferenceSystem srcCrs = CRS.decode("EPSG:3785");

//        CoordinateReferenceSystem targetCrs = CRS.decode("EPSG:4548");
        CoordinateReferenceSystem targetCrs = CRS.decode("EPSG:4326");

        MathTransform mathTransform = CRS.findMathTransform(srcCrs, targetCrs,true);
//        MathTransform mathTransform = CRS.findMathTransform(srcCrs, targetCrs);
        System.out.println("inverse: 16320");
//        System.out.println(CRS.decode("EPSG:16320").toWKT());

        System.out.println("math transform: ");
        System.out.println(mathTransform.toWKT());

        Map<String, AbstractCoordinateOperation> transforms = CRS.getTransforms(srcCrs, targetCrs);
        double best = Double.POSITIVE_INFINITY;
        MathTransform transform = null;
        for(Map.Entry<String, AbstractCoordinateOperation> entry:transforms.entrySet()) {
            double accuracy = entry.getValue().getAccuracy();
            System.out.println(entry.getKey()+"\t"+accuracy);
            if(best>accuracy) {
                best=accuracy;
                transform = entry.getValue().getMathTransform();
            }
        }
        System.out.println("Best transform is "+transform);//
//        MathTransform mathTransform = CRS.findMathTransform(CRS.decode(Constants.CRS_VISUALISATION),
//                CRS.decode(Constants.CGCS2000_3DEGREE_CM_117E), true);
//
        haidian = JTS.transform(haidian, mathTransform);

        WKTWriter wktWriter = new WKTWriter();
        System.out.println(wktWriter.write(haidian));
    }

}